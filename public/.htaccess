# /public/.htaccess
<IfModule mod_rewrite.c>
    RewriteEngine On

    # ========= 1. Permitir encabezado Authorization (JWT) =========
    RewriteCond %{HTTP:Authorization} .+
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # ========= 2. Pre-flight OPTIONS =========
    # Si es una petici√≥n OPTIONS, responde 204 y NO reescribas.
    RewriteCond %{REQUEST_METHOD} =OPTIONS
    RewriteRule ^ - [R=204,L]

    # ========= 3. Reescritura de rutas Phalcon =========
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php?_url=/$1 [QSA,L]
</IfModule>

<IfModule mod_headers.c>
    # ========= 4. Encabezados CORS =========
    # Sustituye el origen por el dominio de tu frontend (sin /* ni comodines).
    SetEnvIf Origin "http(s)?://localhost:5173$" ACAOrigin=$0

    Header always set Access-Control-Allow-Origin "%{ACAOrigin}e" env=ACAOrigin
    Header always set Vary "Origin" env=ACAOrigin
    Header always set Access-Control-Allow-Credentials "true" env=ACAOrigin
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
</IfModule>
